/*
 * A custom JS script to enhance http://www.allegro.cc forums.
 * Copyright Â© 2010 Brandon McCaig
 *
 * This script is used to "enhance" the user experience on the forums at
 * http://www.allegro.cc. You may hotlink it[1], copy it, modify it, or
 * distribute it; but I ask that if you do copy or modify it, you leave
 * this copyright notice intact.
 *
 * Original location: http://www.castopulence.org/js/acc.js
 * Minified: http://www.castopulence.org/js/acc.min.js
 *
 * It depends on jQuery and jQuery UI. Be sure to add both
 * to the list of external JavaScript scripts before this script. A
 * convenient way is by using the Google API servers, which Google
 * encourages you to do anyway[2].
 *
 * For example, add the following lines to your external JavaScript
 * script list:
 *
 * http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js
 * http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.2/jquery-ui.min.js
 * http://www.castoulence.org/js/acc.min.js
 *
 * As one might expect, it comes with NO WARRANTY, etc. USE AT OWN RISK.
 * Also note that it may periodically break as I develop live so you
 * might experience issues on http://www.allegro.cc if you're hotlinking
 * (or otherwise using a broken version). ^_^ I am not to be held liable
 * for this.
 *
 * [1] At least until I see how it affects my bandwidth, but I can't
 * imagine it will hurt it any. If you do hotlink, check this notice
 * periodically to see if I've changed my mind or risk me taking
 * advantage. ^_^
 *
 * [2] http://code.google.com/apis/ajaxlibs/documentation/
 */
jQuery.noConflict();
bam={exceptionDialogCount:0,cloneBr:function(a){a.replaceWith(function(){return"\n"})},cloneCode:function(a){a.replaceWith(function(){var b=jQuery(this);return"<code>"+(b.hasClass("snippet")?"\n":"")+b.text().trim()+(b.hasClass("snippet")?"\n":"")+"</code>"})},cloneCuss:function(a){a.replaceWith(function(){return jQuery(this).text()})},cloneParagraph:function(a){a.replaceWith(function(){return jQuery(this).html()+"\n\n"})},clonePost:function(a){a=a.mockup.clone();this.stripUrlDisclaimers(a);a.find("div.quote_container").each(function(){bam.cloneQuote(jQuery(this))});
a.find(".source-code").each(function(){bam.cloneCode(jQuery(this))});a.find("div.youtube").each(function(){bam.cloneYouTube(jQuery(this))});a.find("img").each(function(){var b=jQuery(this);/^http:\/\/www\.allegro\.cc\/forums\/smileys\//.test(b.attr("src"))&&bam.cloneSmiley(b)});a.find("p").each(function(){bam.cloneParagraph(jQuery(this))});a.find("span.cuss").each(function(){bam.cloneCuss(jQuery(this))});a.find("span.ref").each(function(){bam.cloneReference(jQuery(this))});this.stripReferenceBlock(a);
return a.html()},cloneQuote:function(a){a.replaceWith(function(){var b=bam.getQuote(jQuery(this));return"<quote{name}{src}>{body}</quote>".replace("{name}",b.name?' name="'+bam.htmlEncode(b.name)+'"':"").replace("{src}",b.src?' src="'+bam.htmlEncode(b.src)+'"':"").replace("{body}",b.body)})},cloneReference:function(a){a.replaceWith(function(){var b=jQuery(this),c=b.find("a").text()|0;return"<ref>"+b.parents(".mockup").find(".ref-block li:nth-child("+c+")").html()+"</ref>"})},cloneSmiley:function(a){a.replaceWith(function(){return jQuery(this).attr("alt")})},
cloneYouTube:function(a){a.replaceWith(function(){return"\\["+jQuery(this).find("a").attr("href")+"]"})},htmlDecode:function(a){return a.replace("&quot;",'"').replace("&lt;","<").replace("&gt;",">").replace("&amp;","&")},htmlEncode:function(a){return a.replace("&","&amp;").replace("'","&#39;").replace('"',"&quot;").replace("<","&lt;").replace(">","&gt;")},getPost:function(a){var b;if(a instanceof Number)a=jQuery("#post-"+id);else a instanceof jQuery||(a=jQuery(a));b={originator:a.find(".originator").text(),
memberNumber:a.find(".member-number").text().replace("Member #","")|0,header:a.find(".header"),id:a.get(0).id.replace("post-","")|0,mockup:a.find("td.content > div > .mockup"),post:a,src:a.find(".posted-on > a").get(0).href};if(a.length!=1||b.header.length!=1||b.mockup.length!=1)throw new Error("Invalid argument 'e'. Must be a Number (the post id) or a jQuery object with just the post element selected.");return b},getQuote:function(a){var b,c;a instanceof jQuery||(a=jQuery(a));b=(b=(b=a.find(".title"))&&
b.text())&&b.replace(/ said:$/,"");c=a.find(".title > a").attr("href");if(/^#post-(\d+)/.test(c))c=jQuery(c+" .posted-on a").attr("href");return{body:a.find(".quote").text().trim(),name:b&&b.trim()||"",src:c&&c.trim()||""}},quote:function(a){a=this.getPost(jQuery("#post-"+a));var b=jQuery("#mub-body"),c=this.clonePost(a).trim();b.val(b.val()+(b.val().length!=0?"\n":"")+'<quote name="'+a.originator+'" src="'+a.src+'">\n'+c+(c[c.length-1]!="\n"?"\n":"")+"</quote>")},showException:function(a){a=jQuery(document.body).append('<div class=".bam-exception-dialog" title="Unhandled Exception Caught"><p>The following exception was thrown and not handled:</p><p>'+
a.message+"</p>"+(jQuery.isFunction(a.toSource)?'<a href="javascript:bam.showExceptionVerbose('+this.exceptionDialogCount+');">Show complete exception.</a><p class=".bam-verbose">'+a.toSource()+"</p>":"")+"</div>");a.get(0).id="bam-exception-dialog|"+this.exceptionDialogCount;a.find(".bam-verbose").hide();this.exceptionDialogCount++},showExeptionVerbose:function(a){var b=jQuery("#bam-exception-dialog|"+a);if(b.length!=1)throw new Error("Failed to find exception dialog '"+a+"'.");b.find(".bam-verbose").fadeIn("slow")},
stripReferenceBlock:function(a){a.find(".ref-block").remove()},stripUrlDisclaimers:function(a){a.find("span.url").remove()},stub:function(a){a=this.getPost(jQuery("#post-"+a));var b=jQuery("#mub-body");b.val(b.val()+(b.val().length!=0?"\n":"")+'<quote name="'+a.originator+'" src="'+a.src+'">\n\n</quote>')}};
jQuery(function(){jQuery("#forum-navigation").append('<a href="/cc/theme-css" title="View/edit my custom CSS/JS.">css/js</a> | <a href="https://www.allegro.cc/pm" id="my-pm-link" title="Your private message inbox.">inbox</a> | <a href="/cc/forums-settings" id="my-settings-link" title="View/edit your forum settings.">settings</a>');jQuery("#thread .post").each(function(){var a=bam.getPost(jQuery(this));a.header.append('<a href="#post_form" title="Jump to the mockup box.">Mockup</a> <a href="javascript:bam.quote('+
a.id+');" title="Quote this post.">Quote</a> <a href="javascript:bam.stub('+a.id+');" title="Stub quote this post.">Stub</a>')})});
